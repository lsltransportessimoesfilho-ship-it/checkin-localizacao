<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Chegada</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #cfe4ff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .card {
      background-color: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
    }
    img.logo {
      display: block;
      max-width: 120px;
      height: auto;
      margin: 0 auto 12px;
      object-fit: contain;
    }
    h2 {
      color: #003366;
    }
    .msg {
      margin-top: 15px;
      font-size: 14px;
      color: #333;
    }
    button {
      background-color: #0055cc;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background-color: #0044aa;
    }
  </style>
</head>
<body>

<div class="card">
  <img src="lsl.png" class="logo">
  <h2>Registro de Chegada</h2>
  <p>LSL Transportes da Amazônia – PAD Simões Filho</p>
  <p id="status">Clique no botão abaixo para iniciar o registro.</p>
  <button onclick="solicitarLocalizacao()">Iniciar Registro</button>
  <p class="msg">Este registro só é permitido dentro do perímetro autorizado da empresa.</p>
</div>

<script>
  const LATITUDE_ALVO = -12.6316685;  
  const LONGITUDE_ALVO = -38.265392; 
  const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSc9tq-rajX4bXekfQcl8p01VraF5lRMPg0uJAnVBIx_KTzW5w/viewform?usp=header";
  const RAIO_MAX_METROS = 800;

  function solicitarLocalizacao() {
    // Reseta o texto sempre que clicar no botão
    document.getElementById('status').innerText = "Solicitando permissão de localização...";

    // Força o navegador a tentar obter localização toda vez
    navigator.geolocation.getCurrentPosition(
      verificarPosicao,
      tratarErro,
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
    );
  }

  function verificarPosicao(pos) {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const distancia = calcularDistancia(lat, lon, LATITUDE_ALVO, LONGITUDE_ALVO);
    
    if (distancia <= RAIO_MAX_METROS) {
      document.getElementById('status').innerText = "Dentro do perímetro. Redirecionando...";
      setTimeout(() => window.location.href = FORM_URL, 1500);
    } else {
      document.getElementById('status').innerText = `Você está fora do perímetro (${distancia.toFixed(1)}m). Clique no botão para tentar novamente.`;
    }
  }

  function tratarErro(err) {
    if (err.code === 1) {
      document.getElementById('status').innerText = "Permissão negada. Clique no botão para tentar novamente.";
    } else if (err.code === 2) {
      document.getElementById('status').innerText = "Localização indisponível. Verifique seu GPS.";
    } else if (err.code === 3) {
      document.getElementById('status').innerText = "Tempo de solicitação esgotado. Clique no botão para tentar novamente.";
    } else {
      document.getElementById('status').innerText = "Erro ao obter localização. Tente novamente.";
    }
  }

  function calcularDistancia(lat1, lon1, lat2, lon2) {
    const R = 6371000; // metros
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(lat1 * Math.PI / 180) *
      Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon / 2) * Math.sin(dLon / 2);
